--- 
title: "STAT 245 Course Notes"
author: "Stacy DeRuiter, Calvin University"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
github-repo: stacyderuiter/s245-notes-bookdown
description: "Course notes for the Calvin University course STAT 245, Advanced Data Analysis (a course in applied regression)"
---

# Description

Placeholder



<!--chapter:end:index.Rmd-->


# Linear Regression

Placeholder


## Data
## Simple linear regression, Residuals & Least squares
### Using `lm()` to fit a linear regression in R
### Equation of the fitted regression line
## Multiple regression
### Is it really better?
### Regression residuals = "errors"
### Computing Predictions
## Predictors with two categories
### Predictors with more categories
## Returning to the R Model Summary
## Predictions from the model
### By Hand
#### Comprehension check: 
### Prediction Plots in R
#### Comprehension checks:
#### Shortcut
## Why are we doing this again?
## Shortcut Method - With Uncertainty
### Anatomy of a Confidence Interval
## DIY Method
### Creating a hypothetical dataset
### Making the plot
### Categorical predictors

<!--chapter:end:01-lm1.Rmd-->


# Model Selection Using Information Criteria

Placeholder


## Data and Model
## Calculations
## Decisions with ICs
## All-possible-subsets Selection
## Which IC should I use?
## Quantities derived from AIC
## Important Caution

<!--chapter:end:02-IC-based-selection.Rmd-->


# Likelihood

Placeholder


## Data
## Review - the Normal probability density function (PDF)
## A simple model
## Using the Model to Make Predictions
## Likelihood to the Rescue!
## How does this relate to linear regression?
### Model Equation:
## Likelihood of a dataset, given a model

<!--chapter:end:03-likelihood.Rmd-->


# PDFs and PMFs

Placeholder


## Beyond Normal
## Types of probability distributions
### Continuous distributions
### Discrete Distributions
## Relevant Features of Distributions
## Examples of Continuous Distributions
### Normal
##### Type
##### Support
##### Parameters
##### Shapes
##### PDF or PMF
##### Examples
### Gamma
##### Type
##### Support
##### Parameters
##### Shapes
##### PDF or PMF
##### Examples
### Beta
##### Type
##### Support
##### Parameters
##### Shapes
##### PDF or PMF
##### Examples
## Examples of Discrete Distributions
### Binomial
##### Type
##### Support
##### Parameters
##### Shapes
##### PDF or PMF
##### Examples
### Poisson
##### Type
##### Support
##### Parameters
##### Shapes
##### PDF or PMF
##### Examples
### Negative Binomial
##### Type
##### Support
##### Parameters
##### Shapes
##### PDF or PMF
##### Examples
### A Mixture Distribution: Tweedie
##### Type
##### Support
##### Parameters
##### Shapes
##### PDF or PMF
##### Examples

<!--chapter:end:04-pdf-pmf.Rmd-->


# Regression for Count Data

Placeholder


## Data Source
## A bad idea: multiple linear regression model
## Problems with the linear model
## Poisson Regression
### Fitting the Model
### Conditions
### Model Assessment
### Checking for overdispersion using overdispersion factor
## Accounting for overdispersion: Negative Binomial Models
## Accounting for overdispersion: quasi-Poisson Model
## Model selection with dredge() and (Q)AIC, BIC
### Review: all subsets selection with dredge()
### Review: IC "weights"
### Extending dredge() to quasi-Likelihood
## Offsets
## Prediction Plots

<!--chapter:end:06-count-data-regression.Rmd-->


# Model Averaging

Placeholder


## Data: School Survey on Crime and Safety
## Modelling number of violent incidents per school
## Model Averaging
### Getting the Averaged Model
### Getting Predictions from the Averaged Model

<!--chapter:end:07-model-averaging.Rmd-->


```{r, setup-interactions, include = FALSE}
# load packages that are going to be used
require(tidyverse)   # this loads mosaic, ggformula, etc. too
require(ggformula)
require(mosaic)
require(s245)
# Some customization.  You can alter or delete as desired (if you know what you are doing).

theme_set(theme_bw(base_size=12))     # change theme for ggplot2/ggformula

knitr::opts_chunk$set(
  echo = TRUE,      # for homework, always show R code (this is the default)
  tidy = FALSE,     # display code as typed (rather than reformatted)
  size = "small",   # slightly smaller font for code
  message = FALSE, warning = FALSE,
  fig.width = 6.5, fig.height = 2.1, fig.align = 'center') # don't print warnings or messages in compiled document. So you MUST check them in RStudio!

teach_beauty <- read.csv('http://www.stat.columbia.edu/~gelman/arm/examples/beauty/ProfEvaltnsBeautyPublic.csv') %>%
  rename(beauty = btystdave,
         eval = courseevaluation) %>%
  mutate(race_eth = ifelse(minority == 0, 'White/Caucasian', 'Other'),
         language = ifelse(nonenglish == 1, 'English', 'Other Language'),
         formal = ifelse(formal == 1, 'Formal Dress', 'Informal Dress'),
         female = ifelse(female == 1, 'female', 'not female')) %>%
  select(beauty, eval, race_eth, language, age, students, formal, profnumber, female)
```

# Interactions

Two predictors **interact** when you need to know values of *both* in order to make an accurate prediction of the response variable value.

Predictors can interact in *any* type of regression model (so this chapter could really be placed almost anywhere).

## Example: Quantitative-Categorical Interaction

```{r}
gf_point(eval ~ beauty, color = ~female, shape = ~female, data = teach_beauty) %>%
  gf_lm()
```

`Eval` may go up as `beauty` increases, but the *slope* of the relationship is *different* for females and non-females.  This is an **interaction** between `beauty` and `female`.

## Categorical-Categorical Interaction Example

```{r}
gf_boxplot(eval ~ formal | female, data = teach_beauty)
```

Perhaps *Informal Dress* affects `eval` scores, but really only for non-females -- for females, `formal` dress doesn't make a difference either way.

The effect of `formal` dress is *different* depending on the value of `female`. This is an interaction between `formal` and `female`.

## Quant-Quant interactions?
Yes, these are possible, but very hard to visualize and conceptualize. Basically, it would mean that the slope of the line for one predictor changes gradually as the value of a second variable changes. 

## R code
If you want to include an interaction term in a model in R, use a `*` rather than a `+` between the predictors that (may) interact. For example, based on our exploration above, we might try:

```{r}
beauty_mod <- lm(eval ~ beauty*female +
                   formal*female, 
                 data = teach_beauty, 
                 na.action = 'na.fail')
summary(beauty_mod)
```

Notice the additional indicator variables in the coefficient table/model equation. Now we need to *adjust* the effects of the `beauty` predictor depending on the values of `formal` and `female`, which interact with it.

We can use IC-based model selection to determine whether including these interactions in a model is important or not.

```{r}
require(MuMIn)
dredge(beauty_mod, rank = 'AIC')
```

In the case of the particular model we fitted, the "best" model starting from this full model is actually one *without* interactions. If you want to explore the dataset further, you will find that actually a model where `age`, `beauty` AND `female` interact fits much better...

## Cautionary note
If you include an interaction in a regression model, you **must** also include the corresponding "fixed effects" -- this means if you have an indicator variable/slope term for an interaction in your model, you must also have the indicator variables/slopes corresponding to the individual predictors. Our fitting functions (`lm()`, `glm()`, `glmmTMB()`, etc.) are smart enough to ensure this for you. So is `dredge()`. (It would take effort to mess this up in R.) 

<!--chapter:end:08-Interactions.Rmd-->


# Binary Regression

Placeholder


## Data Source
## Logistic Regression
## Checking the data setup
## Fitting a saturated model
## Link Functions
## Conditions
## Model Assessment Plots
## Odds Ratios
## Model Selection
## Prediction Plots

<!--chapter:end:09-BinaryRegression1.Rmd-->

`r if (knitr:::is_html_output()) '
# References {-}
'`

<!--chapter:end:11-references.Rmd-->

